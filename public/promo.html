<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <title>PROMO BY YUDZXML</title>
  <style>
    /* ========== STYLING HALAMAN PROMO ========== */

    /* Section Promo */
    .promo-section {
      background-color: var(--color-input-bg);
      border: 1px solid var(--color-card-border);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .promo-section h2 {
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
      color: var(--color-text);
    }

    .promo-section p {
      font-size: 1rem;
      color: #555;
    }

    /* Daftar Promo */
    #promo-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }

    /* Setiap Item Promo */
    .promo-item {
      background-color: var(--color-bg);
      border: 1px solid var(--color-card-border);
      border-radius: 8px;
      padding: 1rem;
      transition: box-shadow 0.2s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .promo-item:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Judul dan Deskripsi Promo */
    .promo-item h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--color-text);
    }

    .promo-item p {
      margin-bottom: 0.5rem;
      color: #555;
      line-height: 1.4;
    }

    /* Harga Promo */
    .promo-price {
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
      color: var(--color-btn-danger);
    }

    .promo-price span {
      text-decoration: line-through;
      font-weight: 400;
      color: #999;
      margin-right: 0.5rem;
    }

    /* Validitas Promo */
    .promo-validity {
      font-size: 0.9rem;
      font-style: italic;
      color: #777;
      margin-bottom: 0.75rem;
    }

    /* Tombol WhatsApp */
    .wa-button {
      display: inline-block;
      text-decoration: none;
      background-color: #ff5722;
      color: #fff;
      padding: 0.6rem 0.8rem;
      border-radius: 4px;
      font-size: 0.9rem;
      text-align: center;
      transition: background-color 0.2s ease;
    }

    .wa-button:hover {
      background-color: #1da851;
    }

    /* RESPONSIVE */
    @media (max-width: 768px) {
      #promo-list {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
    <aside id="sidebar">
  <button id="sidebarClose" class="sidebar-close">√ó</button>
  <div class="sidebar-section">
    <button onclick="location.href='loginPromo.html'" class="btn btn-primary sidebar-btn">
      <span class="icon">üîí</span> Admin Login
    </button>
    <button onclick="location.href='cart.html'" class="btn btn-primary sidebar-btn">
      <span class="icon">üõí</span> Cek Keranjang
    </button>
    <button onclick="location.href='testimoni.html'" class="btn btn-primary sidebar-btn">
      <span class="icon">‚≠ê</span> Testimoni
    </button>
    <button onclick="location.href='promo.html'" class="btn btn-primary sidebar-btn">
      <span class="icon">üè∑Ô∏è</span> Diskon Produk
    </button>
    <button onclick="location.href='komentar.html'" class="btn btn-primary sidebar-btn">
      <span class="icon">üí¨</span> Komentar/Ratting
    </button>
    <button onclick="location.href='contact.html'" class="btn btn-primary sidebar-btn">
      <span class="icon">‚úâÔ∏è</span> Contact Admin
    </button>   
    <button onclick="location.href='visitor.html'" class="btn btn-primary sidebar-btn">
          <span class="icon">üë•</span> Static Pengunjung
        </button>
    <button onclick="location.href='donasi.html'" class="btn btn-primary sidebar-btn active">
          <span class="icon">üíñ</span> Donasi
        </button>       
    <button onclick="location.href='tools.html'" class="btn btn-primary sidebar-btn">
      <span class="icon">üõ†Ô∏è</span> Tools
    </button>        
    <button onclick="location.href='service.html'" class="btn btn-primary sidebar-btn">
      <span class="icon">üìú</span> Terms of Service
    </button>        
  </div>
</aside>

    <!-- HEADER -->
    <header class="site-header">
      <div class="container">
        <button id="sidebarToggle" class="sidebar-toggle">‚ò∞</button>
        <div class="header-left">
          <h1 class="logo">„Ç™ INFORMASI PROMO</h1>
        </div>
        <div class="header-center">
          <input
            type="text"
            id="searchInput"
            placeholder="Cari produk..."
            autocomplete="off"
          />
        </div>
        <div class="header-right">
          <button
            id="darkModeToggle"
            class="dark-toggle"
            title="Toggle Dark Mode"
          >
            <div class="toggle-track">
              <span class="icon-sun">‚òÄÔ∏è</span>
              <span class="icon-moon">üåô</span>
            </div>
          </button>
    <button onclick="location.href='index.html'" <span class="icon-btn" title="Keranjang">üè†</button>
        </div>
      </div>
    </header>

  <!-- MAIN CONTENT -->
  <main class="container">
    <section class="promo-section" style="width: 100%; margin-top: 1rem;">
      <h2>PROMO HARI INI</h2>
      <p style="margin-bottom: 1rem; color: #555;">
        Berikut daftar promo yang sedang berlaku:
      </p>

      <!-- Container untuk daftar promo -->
      <div id="promo-list"></div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="site-footer">
    <p>&copy; 2025 Yudzxml. All Rights Reserved.</p>
  </footer>

  <script>
    // ==========================
    // CONSTANTS & SELECTORS
    // ==========================
    const apiUrl = 'https://api.github.com/repos/Yudzxml/WebClientV1/contents/promo.json';

    const sidebarToggleBtn = document.getElementById('sidebarToggle');
    const darkModeToggleBtn = document.getElementById('darkModeToggle');
    const searchInput = document.getElementById('searchInput');
    const promoListContainer = document.getElementById('promo-list');
    const bodyEl = document.body;
    const sidebarEl = document.getElementById('sidebar');
    const goAdminBtn = document.getElementById('goAdminBtn');

    let allPromos = [];

    // ==========================
    // FETCH & RENDER PROMO VIA GITHUB API
    // ==========================
    async function fetchPromos() {
      try {
        // Tampilkan loading sederhana
        promoListContainer.innerHTML = '<p>Loading promo...</p>';

        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error('Gagal mengambil data promo dari GitHub API');
        const data = await res.json();

        // Konten file dalam base64
        const base64Content = data.content;
        const decoded = atob(base64Content); // decode dari base64
        const promos = JSON.parse(decoded);

        allPromos = promos;
        renderPromos(promos);
      } catch (err) {
        console.error(err);
        promoListContainer.innerHTML = '<p style="color:red;">Gagal memuat promo.</p>';
      }
    }
    function formattedDate(dateStr) {
      const tanggal = new Date(dateStr);
      const options = { day: 'numeric', month: 'long', year: 'numeric' };
      return tanggal.toLocaleDateString('id-ID', options);
    }

    function renderPromos(promos) {
      promoListContainer.innerHTML = '';

      const today = new Date();
      promos.forEach(promo => {
        const endDate = new Date(promo.berlaku_sampai);
        const isExpired = endDate < today;

        const div = document.createElement('div');
        div.className = 'promo-item';
        if (isExpired) {
          div.style.opacity = '0.6';
        }

        div.innerHTML = `
          <h3 class="promo-name">${promo.nama}</h3>
          <p class="promo-desc">${promo.deskripsi}</p>
          <p class="promo-price">
            <span>Rp ${promo.harga_awal.toLocaleString('id-ID')}</span>
            Rp ${promo.harga_promo.toLocaleString('id-ID')}
          </p>
          <p class="promo-validity">
            ${
              isExpired
                ? '<span style="color:red;">Promo telah berakhir</span>'
                : 'Berlaku hingga: ' + formattedDate(promo.berlaku_sampai)
            }
          </p>
          ${
            isExpired
              ? ''
              : `<a 
                  href="https://wa.me/${promo.wa_nomor}?text=${encodeURIComponent(
                    'Halo Admin, saya ingin order produk diskon: ' + promo.nama + '\nHarga: ' + promo.harga_promo.toLocaleString('id-ID')
                  )}"
                  class="wa-button" target="_blank"
                >
                  ORDER SEKARANG
                </a>`
          }
        `;
        promoListContainer.appendChild(div);
      });
    }

    // ==========================
    // FILTER (SEARCH) PROMO
    // ==========================
    function filterPromos(query) {
      const term = query.trim().toLowerCase();
      // Jika kosong, tampilkan semua
      if (!term) {
        renderPromos(allPromos);
        return;
      }
      const filtered = allPromos.filter(promo => {
        const nama = promo.nama.toLowerCase();
        const deskripsi = promo.deskripsi.toLowerCase();
        const hargaAwal = promo.harga_awal.toString();
        const hargaPromo = promo.harga_promo.toString();
        const berlaku = promo.berlaku_sampai.toLowerCase();

        return (
          nama.includes(term) ||
          deskripsi.includes(term) ||
          hargaAwal.includes(term) ||
          hargaPromo.includes(term) ||
          berlaku.includes(term)
        );
      });
      renderPromos(filtered);
    }

    // ==========================
    // DARK MODE TOGGLE
    // ==========================
    function applyInitialDarkMode() {
      const saved = localStorage.getItem('darkMode');
      if (saved === 'enabled') {
        bodyEl.classList.add('dark-mode');
      }
    }

    function toggleDarkMode() {
      if (bodyEl.classList.contains('dark-mode')) {
        bodyEl.classList.remove('dark-mode');
        localStorage.setItem('darkMode', 'disabled');
      } else {
        bodyEl.classList.add('dark-mode');
        localStorage.setItem('darkMode', 'enabled');
      }
    }

    // ==========================
    // SIDEBAR TOGGLE
    // ==========================
    function toggleSidebar() {
      if (!sidebarEl) return;
      sidebarEl.classList.toggle('open');
    }
    
    // ==========================
    // EVENT LISTENERS
    // ==========================
    document.addEventListener('DOMContentLoaded', () => {
      fetchPromos();
      applyInitialDarkMode();
    });

    if (searchInput) {
      searchInput.addEventListener('input', e => {
        filterPromos(e.target.value);
      });
    }

    if (darkModeToggleBtn) {
      darkModeToggleBtn.addEventListener('click', () => {
        toggleDarkMode();
      });
    }

   sidebarToggle.addEventListener('click', () => {
    sidebar.classList.add('open');
  });
  
  sidebarClose.addEventListener('click', () => {
    sidebar.classList.remove('open');
  });
    
  </script>
</body>
</html>